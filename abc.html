<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Greenfield Library</title>
    <style>
        /* CSS for modern, responsive design */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-image: url('lib2.jpg'); /* Assume lib2.jpg is in the same directory or provide a URL */
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        header {
            text-align: center;
            padding: 10px;
            background: #007bff;
            color: white;
            border-radius: 8px 8px 0 0;
        }
        nav {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        nav a {
            color: #007bff;
            text-decoration: none;
            padding: 10px;
        }
        nav a:hover {
            background: #eee;
            border-radius: 4px;
        }
        form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        input, select, button {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            background: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background: #f2f2f2;
        }
        .badge {
            padding: 5px 10px;
            border-radius: 4px;
            color: white;
        }
        .available { background: green; }
        .unavailable { background: red; }
        .pending { background: orange; }
        .approved { background: green; }
        .metrics {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }
        .metric {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
        }
        @media (max-width: 768px) {
            .container { padding: 10px; }
            nav { flex-direction: column; }
            table { font-size: 14px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Greenfield Library</h1>
        </header>
        <nav id="nav">
            <!-- Navigation will be updated via JS based on role -->
        </nav>

        <!-- Auth Pages -->
        <div id="register" style="display: none;">
            <h2>Register</h2>
            <form id="registerForm">
                <input type="text" id="regName" placeholder="Name" required>
                <input type="email" id="regEmail" placeholder="Email" required>
                <input type="password" id="regPassword" placeholder="Password" required>
                <select id="regRole" required>
                    <option value="">Select Role</option>
                    <option value="Admin">Admin</option>
                    <option value="Student">Student</option>
                </select>
                <button type="submit">Register</button>
            </form>
            <p>Already have an account? <a href="#" onclick="showLogin()">Login</a></p>
        </div>

        <div id="login" style="display: none;">
            <h2>Login</h2>
            <form id="loginForm">
                <input type="email" id="loginEmail" placeholder="Email" required>
                <input type="password" id="loginPassword" placeholder="Password" required>
                <button type="submit">Login</button>
            </form>
            <p>No account? <a href="#" onclick="showRegister()">Register</a></p>
        </div>

        <!-- Admin Dashboard -->
        <div id="adminDashboard" style="display: none;">
            <h2>Admin Dashboard</h2>
            <div class="metrics">
                <div class="metric">Total Books: <span id="totalBooks">0</span></div>
                <div class="metric">Approved Requests: <span id="approvedRequests">0</span></div>
                <div class="metric">Books Lended: <span id="booksLended">0</span></div>
                <div class="metric">Total Downloads: <span id="totalDownloads">0</span></div>
            </div>
            <h3>Upload Book</h3>
            <form id="uploadBookForm">
                <input type="text" id="bookTitle" placeholder="Title" required>
                <input type="text" id="bookAuthor" placeholder="Author" required>
                <select id="bookCategory" required>
                    <!-- Categories populated via JS -->
                </select>
                <input type="file" id="bookFile" accept=".pdf" required>
                <button type="submit">Upload</button>
            </form>
            <h3>Books List</h3>
            <input type="text" id="bookSearch" placeholder="Search by title/author">
            <select id="categoryFilter">
                <option value="">All Categories</option>
                <!-- Options via JS -->
            </select>
            <table id="booksTable">
                <thead><tr><th>Title</th><th>Author</th><th>Category</th><th>Status</th><th>Downloads</th><th>Actions</th></tr></thead>
                <tbody></tbody>
            </table>
            <h3>Requests</h3>
            <table id="requestsTable">
                <thead><tr><th>Student</th><th>Book</th><th>Status</th><th>Actions</th></tr></thead>
                <tbody></tbody>
            </table>
            <h3>Students</h3>
            <table id="studentsTable">
                <thead><tr><th>Name</th><th>Total Requests</th><th>Approved</th><th>Pending</th><th>Actions</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Student Dashboard -->
        <div id="studentDashboard" style="display: none;">
            <h2>Student Dashboard</h2>
            <input type="text" id="studentSearch" placeholder="Search by title/author">
            <select id="studentCategoryFilter">
                <option value="">All Categories</option>
                <!-- Options via JS -->
            </select>
            <table id="availableBooksTable">
                <thead><tr><th>Title</th><th>Author</th><th>Category</th><th>Status</th><th>Actions</th></tr></thead>
                <tbody></tbody>
            </table>
            <h3>My Requests</h3>
            <table id="myRequestsTable">
                <thead><tr><th>Book</th><th>Status</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Student Detail (Admin View) -->
        <div id="studentDetail" style="display: none;">
            <h2>Student Details: <span id="studentName"></span></h2>
            <table id="studentRequestsTable">
                <thead><tr><th>Book</th><th>Status</th><th>History</th></tr></thead>
                <tbody></tbody>
            </table>
            <button onclick="backToAdmin()">Back</button>
        </div>

        <!-- About Page -->
        <div id="about" style="display: none;">
            <h2>About Greenfield Library</h2>
            <p>This is a library management system for academic institutions. Admins upload books, students request and download them with email notifications.</p>
            <p>Features include role-based access, real-time metrics, and responsive design.</p>
        </div>

        <button id="logout" style="display: none;" onclick="logout()">Logout</button>
    </div>

    <script>
        // JavaScript for client-side functionality
        // Note: Data is stored in localStorage for persistence (simulating DB). In production, use a real backend/DB.
        // Emails: Simulated with console.log and alert (real emails require server-side like EmailJS or backend).

        const storage = {
            users: JSON.parse(localStorage.getItem('users')) || [{id:1, name:'Admin', email:'admin@example.com', password:'admin', role:'Admin'}],
            books: JSON.parse(localStorage.getItem('books')) || [],
            requests: JSON.parse(localStorage.getItem('requests')) || [],
            categories: ['Fiction', 'Non-Fiction', 'Science', 'History'] // Dynamic, can add more
        };

        function saveStorage() {
            localStorage.setItem('users', JSON.stringify(storage.users));
            localStorage.setItem('books', JSON.stringify(storage.books));
            localStorage.setItem('requests', JSON.stringify(storage.requests));
        }

        let currentUser = null;

        function showPage(pageId) {
    // Hide all main content divs
    document.querySelectorAll('.container > div:not(header):not(nav):not(#logout)').forEach(div => {
        div.style.display = 'none';
    });

    // Show the requested page
    const page = document.getElementById(pageId);
    if (page) page.style.display = 'block';

    // Toggle Logout button and Nav
    if (currentUser) {
        document.getElementById('logout').style.display = 'block';
        updateNav();
    } else {
        document.getElementById('logout').style.display = 'none';
    }
}
        

        function updateNav() {
            const nav = document.getElementById('nav');
            nav.innerHTML = '';
            if (currentUser.role === 'Admin') {
                nav.innerHTML = '<a href="#" onclick="showAdminDashboard()">Dashboard</a><a href="#" onclick="showPage(\'about\')">About</a>';
            } else if (currentUser.role === 'Student') {
                nav.innerHTML = '<a href="#" onclick="showStudentDashboard()">Dashboard</a><a href="#" onclick="showPage(\'about\')">About</a>';
            }
        }

        function showRegister() {
            showPage('register');
        }

        function showLogin() {
            showPage('login');
        }

        document.getElementById('registerForm').addEventListener('submit', e => {
            e.preventDefault();
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const role = document.getElementById('regRole').value;
            if (storage.users.find(u => u.email === email)) {
                alert('Email already registered');
                return;
            }
            const id = storage.users.length + 1;
            storage.users.push({id, name, email, password, role});
            saveStorage();
            alert('Registered successfully. Please login.');
            showLogin();
        });

        document.getElementById('loginForm').addEventListener('submit', e => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            currentUser = storage.users.find(u => u.email === email && u.password === password);
            if (currentUser) {
                alert('Logged in as ' + currentUser.role);
                if (currentUser.role === 'Admin') showAdminDashboard();
                else showStudentDashboard();
            } else {
                alert('Invalid credentials');
            }
        });

        function logout() {
            currentUser = null;
            showLogin();
        }

        // Populate categories
        function populateCategories(selectId) {
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">All Categories</option>';
            storage.categories.forEach(cat => {
                const opt = document.createElement('option');
                opt.value = cat;
                opt.textContent = cat;
                select.appendChild(opt);
            });
        }

        // Admin Dashboard
        function showAdminDashboard() {
            showPage('adminDashboard');
            populateCategories('bookCategory');
            populateCategories('categoryFilter');
            loadBooksAdmin();
            loadRequests();
            loadStudents();
            loadMetrics();
        }

        function loadMetrics() {
            const totalBooks = storage.books.length;
            const approvedRequests = storage.requests.filter(r => r.status === 'approved').length;
            const booksLended = approvedRequests; // Assuming lended = approved
            const totalDownloads = storage.books.reduce((sum, b) => sum + (b.downloads || 0), 0);
            document.getElementById('totalBooks').textContent = totalBooks;
            document.getElementById('approvedRequests').textContent = approvedRequests;
            document.getElementById('booksLended').textContent = booksLended;
            document.getElementById('totalDownloads').textContent = totalDownloads;
        }

        function loadBooksAdmin() {
            const tbody = document.querySelector('#booksTable tbody');
            tbody.innerHTML = '';
            const search = document.getElementById('bookSearch').value.toLowerCase();
            const category = document.getElementById('categoryFilter').value;
            storage.books.filter(b => 
                (b.title.toLowerCase().includes(search) || b.author.toLowerCase().includes(search)) &&
                (!category || b.category === category)
            ).forEach(book => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${book.title}</td>
                    <td>${book.author}</td>
                    <td>${book.category}</td>
                    <td><span class="badge ${book.status}">${book.status}</span></td>
                    <td>${book.downloads || 0}</td>
                    <td>
                        <button onclick="toggleStatus(${book.id})">${book.status === 'available' ? 'Disable' : 'Enable'}</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        document.getElementById('bookSearch').addEventListener('input', loadBooksAdmin);
        document.getElementById('categoryFilter').addEventListener('change', loadBooksAdmin);

        document.getElementById('uploadBookForm').addEventListener('submit', e => {
            e.preventDefault();
            const title = document.getElementById('bookTitle').value;
            const author = document.getElementById('bookAuthor').value;
            const category = document.getElementById('bookCategory').value;
            const file = document.getElementById('bookFile').files[0];
            if (!file) return alert('Select PDF');
            const filename = file.name; // In real, upload to server
            const id = storage.books.length + 1;
            storage.books.push({id, title, author, filename, category, status: 'available', downloads: 0});
            saveStorage();
            loadBooksAdmin();
            loadMetrics();
            alert('Book uploaded');
        });

        function toggleStatus(id) {
            const book = storage.books.find(b => b.id === id);
            book.status = book.status === 'available' ? 'unavailable' : 'available';
            saveStorage();
            loadBooksAdmin();
        }

        function loadRequests() {
            const tbody = document.querySelector('#requestsTable tbody');
            tbody.innerHTML = '';
            storage.requests.forEach(req => {
                const user = storage.users.find(u => u.id === req.user_id);
                const book = storage.books.find(b => b.id === req.book_id);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${user.name}</td>
                    <td>${book.title}</td>
                    <td>${req.status}</td>
                    <td>
                        ${req.status === 'pending' ? `<button onclick="approveRequest(${req.id})">Approve</button><button onclick="rejectRequest(${req.id})">Reject</button>` : ''}
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function approveRequest(id) {
            const req = storage.requests.find(r => r.id === id);
            req.status = 'approved';
            saveStorage();
            loadRequests();
            // Simulate email to student
            const user = storage.users.find(u => u.id === req.user_id);
            const book = storage.books.find(b => b.id === req.book_id);
            alert(`Email sent to ${user.email}: Your request for ${book.title} is approved. Download link: [simulated-link-${book.id}]`);
            loadMetrics();
        }

        function rejectRequest(id) {
            const req = storage.requests.find(r => r.id === id);
            req.status = 'rejected';
            saveStorage();
            loadRequests();
            // Simulate email
            const user = storage.users.find(u => u.id === req.user_id);
            alert(`Email sent to ${user.email}: Your request is rejected.`);
        }

        function loadStudents() {
            const tbody = document.querySelector('#studentsTable tbody');
            tbody.innerHTML = '';
            storage.users.filter(u => u.role === 'Student').forEach(student => {
                const studentReqs = storage.requests.filter(r => r.user_id === student.id);
                const total = studentReqs.length;
                const approved = studentReqs.filter(r => r.status === 'approved').length;
                const pending = studentReqs.filter(r => r.status === 'pending').length;
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${student.name}</td>
                    <td>${total}</td>
                    <td>${approved}</td>
                    <td>${pending}</td>
                    <td><button onclick="showStudentDetail(${student.id})">View</button></td>
                `;
                tbody.appendChild(tr);
            });
        }

        function showStudentDetail(id) {
            const student = storage.users.find(u => u.id === id);
            document.getElementById('studentName').textContent = student.name;
            const tbody = document.querySelector('#studentRequestsTable tbody');
            tbody.innerHTML = '';
            storage.requests.filter(r => r.user_id === id).forEach(req => {
                const book = storage.books.find(b => b.id === req.book_id);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${book.title}</td>
                    <td>${req.status}</td>
                    <td><!-- History can be expanded if needed --></td>
                `;
                tbody.appendChild(tr);
            });
            showPage('studentDetail');
        }

        function backToAdmin() {
            showAdminDashboard();
        }

        // Student Dashboard
        function showStudentDashboard() {
            showPage('studentDashboard');
            populateCategories('studentCategoryFilter');
            loadAvailableBooks();
            loadMyRequests();
        }

        function loadAvailableBooks() {
            const tbody = document.querySelector('#availableBooksTable tbody');
            tbody.innerHTML = '';
            const search = document.getElementById('studentSearch').value.toLowerCase();
            const category = document.getElementById('studentCategoryFilter').value;
            storage.books.filter(b => 
                b.status === 'available' &&
                (b.title.toLowerCase().includes(search) || b.author.toLowerCase().includes(search)) &&
                (!category || b.category === category)
            ).forEach(book => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${book.title}</td>
                    <td>${book.author}</td>
                    <td>${book.category}</td>
                    <td><span class="badge available">available</span></td>
                    <td><button onclick="requestBook(${book.id})">Request</button></td>
                `;
                tbody.appendChild(tr);
            });
        }

        document.getElementById('studentSearch').addEventListener('input', loadAvailableBooks);
        document.getElementById('studentCategoryFilter').addEventListener('change', loadAvailableBooks);

        function requestBook(bookId) {
            if (storage.requests.find(r => r.user_id === currentUser.id && r.book_id === bookId)) {
                alert('Already requested');
                return;
            }
            const id = storage.requests.length + 1;
            storage.requests.push({id, user_id: currentUser.id, book_id: bookId, status: 'pending'});
            saveStorage();
            loadMyRequests();
            // Simulate email to admin
            alert('Request submitted. Email sent to admin.');
        }

        function loadMyRequests() {
            const tbody = document.querySelector('#myRequestsTable tbody');
            tbody.innerHTML = '';
            storage.requests.filter(r => r.user_id === currentUser.id).forEach(req => {
                const book = storage.books.find(b => b.id === req.book_id);
                const tr = document.createElement('tr');
                let action = '';
                if (req.status === 'approved') {
                    action = `<button onclick="downloadBook(${req.book_id})">Download</button>`;
                }
                tr.innerHTML = `
                    <td>${book.title}</td>
                    <td><span class="badge ${req.status}">${req.status}</span> ${action}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function downloadBook(bookId) {
            const book = storage.books.find(b => b.id === bookId);
            book.downloads = (book.downloads || 0) + 1;
            saveStorage();
            alert(`Downloading ${book.filename}... (simulated. In real, provide link to PDF)`);
            // In real, window.location = book.filename or server download
            loadAvailableBooks(); // Refresh if needed
            loadMyRequests();
        }

        // Initial load
        showLogin();
    </script>
</body>
</html>